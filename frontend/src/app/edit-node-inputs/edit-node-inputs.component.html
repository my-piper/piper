<ng-template #noInputsTemplate>
  <p>
    No inputs for node, please go to <a [routerLink]="['design']">Design</a>
  </p>
</ng-template>

<header class="stack vertical">
  <div class="stack horizontal align-center">
    <h1>{{ node.title | i18n }}</h1>
    <ng-template #descriptionPopover>
      <div
        class="description"
        [innerHTML]="node.description | markdown | async"
      ></div>
    </ng-template>
    <app-icon
      *ngIf="node.description as description"
      icon="info"
      [size]="18"
      [appPopover]="{ content: descriptionPopover }"
    ></app-icon>
  </div>

  <form [formGroup]="form">
    <fieldset>
      <div class="stack align-center">
        <div class="checkbox">
          <label class="switch">
            <input type="checkbox" formControlName="start" />
            <span class="slider"></span>
          </label>
        </div>
        <span i18n="@@label.auto_start">Auto start</span>
      </div>
    </fieldset>
  </form>
</header>

<ng-container *ngIf="node.render.inputs as groups">
  <form *ngIf="groups.length > 0; else noInputsTemplate" [formGroup]="form">
    <ng-container *ngFor="let g of groups">
      <h2 *ngIf="g.group.group?.title as group">
        {{ group | i18n }}
        <sup *ngIf="userRole.admin | can | async">
          {{ g.group.group.order }}
        </sup>
      </h2>
      <fieldset class="inputs stack vertical huge" formGroupName="inputs">
        <ng-container *ngFor="let i of g.group.inputs">
          <div class="input stack vertical" [formGroupName]="i.id">
            <div class="stack align-center justify-between">
              <div class="stack align-center flex">
                {{ i.input.title | i18n }}
                <ng-template #inputDescriptionPopover>
                  <div
                    [innerHTML]="i.input.description | markdown | async"
                  ></div>
                </ng-template>
                <app-icon
                  *ngIf="i.input.description"
                  [appPopover]="{ content: inputDescriptionPopover }"
                  icon="help"
                  [color]="ui.color.grey"
                  [size]="18"
                ></app-icon>
              </div>
              <div class="stack small">
                <button
                  *ngIf="!!i.input.cloned"
                  class="circle small"
                  (click)="removeInput(i.id)"
                >
                  <app-icon class="icon" icon="minus" [size]="12"></app-icon>
                </button>
                <button
                  *ngIf="!!i.input.dynamic && !i.input.cloned"
                  class="circle small"
                  (click)="addDynamic(i.input)"
                >
                  <app-icon class="icon" icon="add" [size]="12"></app-icon>
                </button>
                <button
                  class="circle small"
                  (click)="
                    i.input.featured
                      ? markUnFeatured(i.id)
                      : markFeatured(i.input)
                  "
                >
                  <app-icon
                    class="icon"
                    [icon]="i.input.featured ? 'in' : 'out'"
                    [size]="12"
                  ></app-icon>
                </button>
              </div>
            </div>
            <app-edit-input
              *ngIf="!i.input.featured"
              [id]="i.id"
              [type]="i.input.type"
              [enum]="i.input.enum"
              [freeform]="i.input.freeform"
              [multiline]="i.input.multiline"
              [default]="i.input.default"
              [placeholder]="i.input.placeholder"
              [min]="i.input.min"
              [max]="i.input.max"
              [step]="i.input.step"
              formControlName="value"
              [inputs]="inputsGroup"
            ></app-edit-input>
          </div>
        </ng-container>
      </fieldset>
    </ng-container>
  </form>
</ng-container>

<footer *ngIf="userRole.engineer | can | async">
  <a
    [routerLink]="{ outlets: { primary: ['nodes', id, 'edit'] } }"
    [relativeTo]="route.parent"
    class="primary with-icon"
  >
    <app-icon
      class="icon left"
      [icon]="node.locked ? 'lock' : 'lock'"
      [size]="16"
    ></app-icon>
    Edit
  </a>
</footer>
